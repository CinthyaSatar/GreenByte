{% extends "layout.html" %}
{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-xl-8 col-lg-10">
      <div class="card shadow-sm mb-4" style="background: white;
                  border-radius: 1.5rem !important;
                  box-shadow: 0 15px 30px rgba(28, 200, 138, 0.15) !important;">
        <div class="position-relative">
          {% if post.images %}
          <!-- Image Carousel -->
          <div id="carousel{{ post.id }}" class="carousel slide" data-bs-ride="carousel">
            <!-- Garden badge moved to user info section -->
            <div class="carousel-inner">
              {% for image in post.images %}
              <div class="carousel-item {% if loop.first %}active{% endif %}">
                <img src="{{ url_for('static', filename='post_pics/' + image.image_file) }}"
                     class="d-block w-100" alt="{{ image.caption }}"
                     style="border-top-left-radius: 1.5rem; border-top-right-radius: 1.5rem; object-fit: cover; height: 300px;">
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Custom Carousel Controls -->
          {% if post.images|length > 1 %}
          <div class="d-flex justify-content-between align-items-center px-4 py-2"
               style="background-color: #f8f9fc; border-bottom: 1px solid #e3e6f0;">
            <!-- Left Control -->
            <button type="button"
                    data-bs-target="#carousel{{ post.id }}"
                    data-bs-slide="prev"
                    class="btn btn-sm btn-light rounded-circle"
                    style="width: 32px; height: 32px; padding: 0; border: 1px solid #e3e6f0;">
              <i class="fas fa-chevron-left text-success"></i>
            </button>

            <!-- Indicators -->
            <div class="carousel-indicators position-relative bottom-0 m-0" style="z-index: 0;">
              {% for image in post.images %}
              <button type="button"
                      data-bs-target="#carousel{{ post.id }}"
                      data-bs-slide-to="{{ loop.index0 }}"
                      class="{% if loop.first %}active{% endif %}"
                      style="width: 8px; height: 8px; border-radius: 50%; background-color: #1cc88a;"
                      {% if loop.first %}aria-current="true"{% endif %}
                      aria-label="Slide {{ loop.index }}"></button>
              {% endfor %}
            </div>

            <!-- Right Control -->
            <button type="button"
                    data-bs-target="#carousel{{ post.id }}"
                    data-bs-slide="next"
                    class="btn btn-sm btn-light rounded-circle"
                    style="width: 32px; height: 32px; padding: 0; border: 1px solid #e3e6f0;">
              <i class="fas fa-chevron-right text-success"></i>
            </button>
          </div>
          {% endif %}
          {% endif %}
        </div>

        <div class="card-body p-4 position-relative">
          {% if post.author == current_user %}
          <div class="position-absolute top-0 end-0 {% if post.garden and not post.images %}mt-5 pt-2 me-3{% else %}m-3{% endif %}" style="z-index: 10;">
            <a class="btn btn-sm"
               href="{{ url_for('posts.updatePost', postId=post.id) }}"
               style="background-color: rgba(28, 200, 138, 0.1);
                      color: #1cc88a;
                      border-radius: 0.5rem;
                      border: 1px solid rgba(28, 200, 138, 0.2);">
              <i class="fas fa-edit me-1"></i> Edit
            </a>
          </div>
          {% endif %}

          <!-- Garden badge moved to user info section -->

          <div class="d-flex align-items-center mb-2">
            <img src="{{ url_for('static', filename='profilePics/' + post.author.image_file) }}"
                class="rounded-circle me-3" alt="{{ post.author.firstName }} {{ post.author.lastName }}"
                style="width: 50px; height: 50px; object-fit: cover; border: 2px solid rgba(28, 200, 138, 0.2);">
            <div>
              <h6 class="mb-0 fw-bold">
                <a href="{{ url_for('users.page_user', username=post.author.username) }}"
                   class="text-decoration-none text-dark hover-success">
                  {{ post.author.firstName }} {{ post.author.lastName }}
                </a>
              </h6>
              <small class="text-muted">{{ post.date_posted.strftime('%B %d, %Y') }} Â· {{ post.read_time }} min read</small>
              {% if post.garden %}
              <div class="mt-1">
                <a href="#" class="text-decoration-none">
                  <span class="badge bg-success px-2 py-1"
                        style="border-radius: 0.5rem;
                               box-shadow: 0 2px 4px rgba(28, 200, 138, 0.2);">
                    <i class="fas fa-leaf me-1"></i> {{ post.garden.name }}
                  </span>
                </a>
              </div>
              {% endif %}
            </div>
          </div>

          <h4 class="font-weight-bold mb-2">
            <span class="text-success">{{ post.title }}</span>
          </h4>

          <!-- Post Tags moved to footer -->

          <!-- Garden Details Tags -->
          {% if post.garden_id or post.garden_type or post.garden_size or post.plant_count or post.start_date_formatted %}
          <div class="d-flex flex-wrap gap-2 mb-3">
            {% if post.garden_type %}
            <span class="badge bg-light text-success p-2" style="border-radius: 0.35rem !important;">
              <i class="fas fa-map-marker-alt"></i> {{ post.garden_type }}
            </span>
            {% endif %}
            {% if post.garden_size %}
            <span class="badge bg-light text-success p-2" style="border-radius: 0.35rem !important;">
              <i class="fas fa-ruler-combined"></i> {{ post.garden_size }} sq ft
            </span>
            {% endif %}
            {% if post.plant_count %}
            <span class="badge bg-light text-success p-2" style="border-radius: 0.35rem !important;">
              <i class="fas fa-seedling"></i> {{ post.plant_count }} Plants
            </span>
            {% endif %}
            {% if post.start_date_formatted %}
            <span class="badge bg-light text-success p-2" style="border-radius: 0.35rem !important;">
              <i class="fas fa-clock"></i> Started {{ post.start_date_formatted }}
            </span>
            {% endif %}
          </div>
          {% endif %}

          <p class="mb-3">{{ post.content }}</p>

          <!-- Post Tags and Engagement -->
          <div class="border-top mt-3 pt-3">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex flex-wrap gap-1">
                {% if post.tags %}
                  {% for tag in post.tags %}
                  <span class="badge me-1 mb-1"
                        style="background-color: transparent;
                               color: #6c757d;
                               border-radius: 0.25rem;
                               padding: 0.3rem 0.5rem;
                               border: 1px dashed rgba(108, 117, 125, 0.5);
                               font-weight: 400;
                               font-size: 0.75rem;
                               letter-spacing: 0.02em;">
                    <i class="fas fa-hashtag me-1 opacity-75" style="font-size: 0.7rem;"></i>{{ tag.name }}
                  </span>
                  {% endfor %}
                {% endif %}
              </div>
              <div class="d-flex gap-3">
                <button class="btn btn-sm"
                        style="background-color: rgba(28, 200, 138, 0.1);
                               color: #1cc88a;
                               border-radius: 0.5rem;
                               border: 1px solid rgba(28, 200, 138, 0.2);">
                  <i class="far fa-heart me-1"></i> Like
                </button>
                <button class="btn btn-sm"
                        style="background-color: rgba(28, 200, 138, 0.1);
                               color: #1cc88a;
                               border-radius: 0.5rem;
                               border: 1px solid rgba(28, 200, 138, 0.2);">
                  <i class="far fa-comment me-1"></i> Comment
                </button>
                <button class="btn btn-sm share-btn"
                        data-post-url="{{ url_for('posts.post', postId=post.id, _external=True) }}"
                        onclick="sharePost(this)"
                        style="background-color: rgba(28, 200, 138, 0.1);
                               color: #1cc88a;
                               border-radius: 0.5rem;
                               border: 1px solid rgba(28, 200, 138, 0.2);">
                  <i class="far fa-share-square me-1"></i> Share
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% endblock content %}
